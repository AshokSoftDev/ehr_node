model Patient {
  patient_id    Int       @id @default(autoincrement())
  mrn           String    @unique
  title         String
  firstName     String
  lastName      String
  dateOfBirth   DateTime?
  age           Int?
  gender        String
  mobileNumber  String
  address       String
  area          String
  city          String
  state         String
  country       String
  pincode       String
  aadhar        String?
  referalSource String?
  comments      String?
  activeStatus  Int       @default(1)
  createdAt     DateTime  @default(now())
  createdBy     String
  updatedAt     DateTime  @updatedAt
  updatedBy     String

  // Relations
  appointments     Appointment[]
  visits           Visit[]
  patientAllergies PatientAllergy[]
  patientInfo      PatientInfo?
  patientEmergency PatientEmergency[]
  clinicalNotes    ClinicalNotes[]
  prescriptions    Prescription[]
  visitDocuments   VisitDocument[]
}

model PatientAllergy {
  id          Int     @id @default(autoincrement())
  patient_id  Int
  allergy_id  Int?
  allergyName String
  notes       String?

  // Status & Audit
  status    Int       @default(1) // 1=active, 0=inactive
  createdAt DateTime  @default(now())
  createdBy String?
  updatedAt DateTime  @updatedAt
  updatedBy String?
  deletedAt DateTime?
  deletedBy String?

  // Relations
  patient Patient  @relation(fields: [patient_id], references: [patient_id])
  allergy Allergy? @relation(fields: [allergy_id], references: [allergy_id])

  @@index([patient_id])
  @@index([allergy_id])
  @@index([status])
  @@index([createdAt])
  @@index([deletedAt])
}

model PatientInfo {
  pi_id           Int       @id @default(autoincrement())
  patient_id      Int       @unique
  bloodGroup      String
  overseas        Boolean
  passportNumber  String?
  validityDate    DateTime?
  occupation      String?
  department      String?
  companyName     String?
  designation     String?
  employeeCode    String?
  primaryDoctorId String?
  activeStatus    Int       @default(1)
  createdAt       DateTime  @default(now())
  createdBy       String?
  updatedAt       DateTime  @updatedAt
  updatedBy       String?
  deletedAt       DateTime?
  deletedBy       String?

  patient Patient @relation(fields: [patient_id], references: [patient_id])
  doctor  Doctor? @relation(fields: [primaryDoctorId], references: [id])

  @@index([patient_id])
  @@index([primaryDoctorId])
  @@index([activeStatus])
}

model PatientEmergency {
  pe_id         Int       @id @default(autoincrement())
  patient_id    Int
  name          String
  relation      String
  contactNumber String
  status        Int       @default(1)
  createdAt     DateTime  @default(now())
  createdBy     String?
  updatedAt     DateTime  @updatedAt
  updatedBy     String?
  deletedAt     DateTime?
  deletedBy     String?

  patient Patient @relation(fields: [patient_id], references: [patient_id])

  @@index([patient_id])
  @@index([status])
  @@index([createdAt])
  @@index([deletedAt])
}
